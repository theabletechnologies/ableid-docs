---
id: schema
title: Схема взаимодействия
---

## Схема взаимодействия

![Схема взаимодействия](/img/schema.png)

> **Для получения информации о получении определенных данных (паспорт, прописка, фото, данные нерезидента) через API и настройке Webhooks перейдите в раздел [Webhooks](/hooks).**

---

## Идентификация vs Верификация

AbleID предоставляет два типа биометрических проверок: **Идентификация** и **Верификация**. Важно понимать разницу между ними для правильного выбора метода.

### Идентификация (Identification)

**Назначение:** Первичная биометрическая проверка личности пользователя с полной проверкой живости (liveness).

**Когда использовать:**
- Первичная регистрация пользователя
- Важные операции, требующие высокого уровня безопасности
- KYC процедуры
- Открытие счетов, кредитование

**Особенности процесса:**
- Полная проверка живости (liveness) с активными действиями
- Пользователь выполняет повороты головы по указаниям системы
- Более длительный процесс (~30-60 секунд)
- Максимальный уровень защиты от спуфинга

**API методы:**
- `/check/start/second` — идентификация резидентов
- `/check/start/foreign` — идентификация нерезидентов

### Верификация (Verification)

**Назначение:** Быстрая повторная проверка личности ранее идентифицированного пользователя.

**Когда использовать:**
- Повторный вход в систему
- Подтверждение транзакций
- Регулярные операции после первичной идентификации
- Случаи, где важна скорость процесса

**Особенности процесса:**
- Упрощенная проверка живости
- Снимок делается автоматически без активных действий
- Быстрый процесс (~10-20 секунд)
- Сохранен достаточный уровень безопасности для повторных проверок

**API методы:**
- `/check/start/verification/second` — верификация резидентов
- `/check/start/verification/foreign` — верификация нерезидентов

### Сравнительная таблица

| Параметр                | Идентификация                  | Верификация               |
|-------------------------|--------------------------------|---------------------------|
| **Проверка живости**    | Полная (с поворотами головы)   | Упрощенная (автоматическая) |
| **Длительность**        | ~30-60 секунд                  | ~10-20 секунд             |
| **Уровень безопасности**| Максимальный                   | Высокий                   |
| **Использование**       | Первичная проверка             | Повторные проверки        |
| **User Experience**     | Требует активных действий      | Пассивная проверка        |

### Рекомендации

1. **Используйте Идентификацию** для первого взаимодействия с пользователем и критичных операций
2. **Используйте Верификацию** для повторных проверок и регулярных операций
3. Периодически (например, раз в месяц) проводите полную Идентификацию даже для существующих пользователей
4. Для особо критичных операций (крупные переводы, изменение реквизитов) используйте Идентификацию независимо от статуса пользователя

---

## 1. Инициализация сессии

Партнерское приложение отправляет запрос в партнерский backend для инициализации новой сессии. Партнерский backend выполняет следующие действия:

- Создает запрос к AbleID на инициализацию сессии, указывая тип пользователя (резидент или нерезидент)
  - **Резидент**: ПИНФЛ + Дата рождения
  - **Нерезидент**: Серия и номер паспорта
- Получает от AbleID параметры сессии: идентификатор (attemptId) и URL для загрузки интерфейса в WebView (fullUrl)
- Возвращает в партнерское приложение данные в зависимости от типа интеграции:
  - **WEB**: Прямая ссылка для открытия в браузере
  - **SDK**: Идентификатор сессии и домен для выполнения процесса

### Время жизни сессии

Каждая созданная сессия имеет **ограниченное время жизни — 10 минут** с момента создания.

**Что происходит при истечении времени:**

- **Сессия становится недействительной:** Нельзя начать или продолжить процесс идентификации
- **Webhook НЕ отправляется:** Уведомления отправляются только при явном завершении сессии (успех/ошибка)
- **Ошибка при попытке использования:** При обращении к истекшей сессии возвращается ошибка:
  ```json
  {
    "statusCode": 10101,
    "type": "FACE_SESSION_EXPIRED",
    "message": "Время сессии истекло"
  }
  ```

**Рекомендации:**

- Создавайте новую сессию непосредственно перед началом процесса идентификации
- Не создавайте сессии заранее "про запас"
- При получении ошибки `FACE_SESSION_EXPIRED` создайте новую сессию
- Информируйте пользователя о необходимости завершить процесс в течение 10 минут

> **Важно:** Время жизни сессии **нельзя продлить**. Если время истекло, необходимо создать новую сессию с новым `attemptId`.

# 2. Прохождение процесса и обработка

## 2.1. Проверка живости (Liveness)

После инициализации сессии пользователь проходит проверку живости, процесс которой различается в зависимости от типа операции:

- Идентификация
  - Пользователю отображается интерактивный модуль с указаниями для выполнения действий. На экране последовательно показываются направления, в которые необходимо повернуть голову. Пользователь следует инструкциям, выполняя требуемые движения головой, что позволяет системе убедиться в присутствии реального человека перед камерой.
- Верификация
  - Процесс проверки живности упрощён и не требует от пользователя выполнения специальных действий. Снимок для верификации делается автоматически, без отображения направлений для поворота головы. Это обеспечивает более быстрое прохождение.

## 2.2. Валидация и проверка данных

Каждый этап процесса подвергается многоступенчатой обработке и валидации:

- Полученные биометрические данные проходят первичную проверку на качество и соответствие требованиям
- Система анализирует результаты проверки живости для выявления попыток мошенничества
- Выполняется повторная перепроверка критичных параметров для обеспечения точности результата

## 2.3. Биометрическое сравнение

На финальном этапе обработки WEB/SDK осуществляет прямое взаимодействие с AbleID для выполнения биометрического сравнения:

- Система сопоставляет фотографию из документа пользователя с биометрическими данными, полученными в процессе проверки живости
- Алгоритмы анализируют степень соответствия лица на документе и лица пользователя, проходившего верификацию
- На основе полученных данных формируется итоговое решение о прохождении или отклонении верификации

Весь процесс обработки происходит в режиме реального времени, обеспечивая быстрое получение результата.

## 3. Завершение и уведомление

По завершении процесса обработки:

1. **AbleID → Партнерский backend**: при наличии переданных webhook параметров отправляется уведомление о результате выполнения (успех или ошибка)
2. **AbleID → Партнерское приложение**: выполняется редирект на соответствующую страницу:
   - Страница успешного завершения или ошибки
   - В случае WEB-интеграции AbleID отправляет postMessage с параметрами:
     - type: redirect
     - url: адрес для перенаправления пользователя (https://example.com/redirect)

### Настройка Redirect URL

> **ВАЖНО:**
>
> 1. **Статические URL:** В конфигурации проекта прописываются **2 статических URL** для редиректа пользователя:
>    - URL успешного прохождения идентификации/верификации
>    - URL при ошибке или неуспешном прохождении
> 2. **Изменение URL:** Redirect URL изменяются **ТОЛЬКО** по запросу в службу поддержки. Динамическое изменение redirect URL в процессе работы **НЕ** поддерживается.
> 3. **Обязательная настройка:** Для работы системы необходимо заранее предоставить команде поддержки оба URL для их регистрации в конфигурации проекта.

**Редиректы будут на ранее переданные статичные страницы со стороны партнера (успеха / ошибки)**

Для настройки или обновления Redirect URL обратитесь к нашей команде поддержки:

| Назначение     | Описание                                                                                  |
|----------------|-------------------------------------------------------------------------------------------|
| **URL успеха** | Страница, на которую перенаправляется пользователь при успешной идентификации/верификации |
| **URL ошибки** | Страница, на которую перенаправляется пользователь при неуспешном прохождении или ошибке  |

---

## Пример обработки postMessage перед редиректом

Пример

```json
{
  "type": "redirect",
  "url": "https://example.com/redirect"
}
```

Получение сообщения перед редиректом (родительское окно)

```javascript
window.addEventListener("message", function (event) {
  if (event.data.type === "redirect" && event.data.url) {
    window.location.href = event.data.url;
  }
});
```

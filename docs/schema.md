---
id: schema
title: Схема взаимодействия
---

## Схема взаимодействия

![Схема взаимодействия](/img/schema.png)

## 1. Инициализация сессии

Партнерское приложение отправляет запрос в партнерский backend для инициализации новой сессии. Партнерский backend выполняет следующие действия:

- Создает запрос к AbleID на инициализацию сессии, указывая тип пользователя (резидент или нерезидент)
  - **Резидент**: ПИНФЛ + Дата рождения
  - **Нерезидент**: Серия и номер паспорта
- Получает от AbleID параметры сессии: идентификатор (attemptId) и URL для загрузки интерфейса в WebView (fullUrl)
  - Время жизни сессии 10 мин
- Возвращает в партнерское приложение данные в зависимости от типа интеграции:
  - **WEB**: Прямая ссылка для открытия в браузере
  - **SDK**: Идентификатор сессии и домен для выполнения процесса

# 2. Прохождение процесса и обработка

## 2.1. Проверка живости (Liveness)

После инициализации сессии пользователь проходит проверку живости, процесс которой различается в зависимости от типа операции:

- Идентификация
  - Пользователю отображается интерактивный модуль с указаниями для выполнения действий. На экране последовательно показываются направления, в которые необходимо повернуть голову. Пользователь следует инструкциям, выполняя требуемые движения головой, что позволяет системе убедиться в присутствии реального человека перед камерой.
- Верификация
  - Процесс проверки живности упрощён и не требует от пользователя выполнения специальных действий. Снимок для верификации делается автоматически, без отображения направлений для поворота головы. Это обеспечивает более быстрое прохождение.

## 2.2. Валидация и проверка данных

Каждый этап процесса подвергается многоступенчатой обработке и валидации:

- Полученные биометрические данные проходят первичную проверку на качество и соответствие требованиям
- Система анализирует результаты проверки живости для выявления попыток мошенничества
- Выполняется повторная перепроверка критичных параметров для обеспечения точности результата

## 2.3. Биометрическое сравнение

На финальном этапе обработки WEB/SDK осуществляет прямое взаимодействие с AbleID для выполнения биометрического сравнения:

- Система сопоставляет фотографию из документа пользователя с биометрическими данными, полученными в процессе проверки живости
- Алгоритмы анализируют степень соответствия лица на документе и лица пользователя, проходившего верификацию
- На основе полученных данных формируется итоговое решение о прохождении или отклонении верификации

Весь процесс обработки происходит в режиме реального времени, обеспечивая быстрое получение результата.

## 3. Завершение и уведомление

По завершении процесса обработки:

1. **AbleID → Партнерский backend**: при наличии переданных webhook параметров отправляется уведомление о результате выполнения (успех или ошибка)
2. **AbleID → Партнерское приложение**: выполняется редирект на соответствующую страницу:
   - Страница успешного завершения или ошибки
   - В случае WEB-интеграции AbleID отправляет postMessage с параметрами:
     - type: redirect
     - url: адрес для перенаправления пользователя (https://example.com/redirect)

**Редиректы будут на ранее переданные статичные страницы со стороны партнера (успеха / ошибки)**

---

## Пример обработки postMessage перед редиректом

Пример

```json
{
  "type": "redirect",
  "url": "https://example.com/redirect"
}
```

Получение сообщения перед редиректом (родительское окно)

```javascript
window.addEventListener("message", function (event) {
  if (event.data.type === "redirect" && event.data.url) {
    window.location.href = event.data.url;
  }
});
```

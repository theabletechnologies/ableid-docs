---
id: schema
title: Схема взаимодействия
---

## Схема взаимодействия
![Схема взаимодействия](/img/schema.png)

## 1. Инициализация сессии

Партнерское приложение отправляет запрос в партнерский backend для инициализации новой сессии. Партнерский backend выполняет следующие действия:

- Создает запрос к AbleID на инициализацию сессии, указывая тип пользователя (резидент или нерезидент)
    - **Резидент**: ПИНФЛ + Дата рождения
    - **Нерезидент**: Серия и номер паспорта
- Получает от AbleID параметры сессии: идентификатор (attemptId) и URL для загрузки интерфейса в WebView (fullUrl)
    - Время жизни сессии 10 мин
- Возвращает в партнерское приложение данные в зависимости от типа интеграции:
    - **WEB**: Прямая ссылка для открытия в браузере
    - **SDK**: Идентификатор сессии и домен для выполнения процесса

## 2. Фаза обработки

На этапе обработки WEB/SDK осуществляет прямое взаимодействие с AbleID

## 3. Завершение и уведомление

По завершении процесса обработки:

1. **AbleID → Партнерский backend**: при наличии переданных webhook параметров отправляется уведомление о результате выполнения (успех или ошибка)
2. **AbleID → Партнерское приложение**: выполняется редирект на соответствующую страницу:
    - Страница успешного завершения или ошибки
    - В случае WEB-интеграции AbleID отправляет postMessage с параметрами:
      - Тип: redirect
      - URL: адрес для перенаправления пользователя
